<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cursor Sharing System</title>
  <style>
    body {
      margin: 0;
      height: 100vh;
      background: #f5f5f5;
      overflow: hidden;
      cursor: none; /* hide default cursor */
    }
    .cursor {
      position: absolute;
      width: 15px;
      height: 15px;
      border-radius: 50%;
      background: red;
      pointer-events: none;
      transform: translate(-50%, -50%);
    }
  </style>
</head>
<body>
  <script type="module">
    // Import Firebase SDK
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
    import { getDatabase, ref, set, onValue, remove } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-database.js";

    // Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyD0T-mS__FlN3QASJnmD0K6S5VNDiN2bxQ",
      authDomain: "poplol-7209f.firebaseapp.com",
      projectId: "poplol-7209f",
      storageBucket: "poplol-7209f.appspot.com",
      messagingSenderId: "105810834",
      appId: "1:105810834:web:example"
    };

    // Init Firebase
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Unique ID for this user
    const userId = "user-" + Math.random().toString(36).substr(2, 9);

    // Track cursor and update Firebase
    document.addEventListener("mousemove", (e) => {
      set(ref(db, "cursors/" + userId), {
        x: e.clientX,
        y: e.clientY,
        color: cursorColor
      });
    });

    // Remove cursor on disconnect/close
    window.addEventListener("beforeunload", () => {
      remove(ref(db, "cursors/" + userId));
    });

    // Random color for each user cursor
    const colors = ["red", "blue", "green", "purple", "orange"];
    const cursorColor = colors[Math.floor(Math.random() * colors.length)];

    // Cursor elements
    const cursors = {};

    // Listen for cursor updates
    onValue(ref(db, "cursors"), (snapshot) => {
      const data = snapshot.val() || {};

      // Create/update cursors
      for (let id in data) {
        if (!cursors[id]) {
          const el = document.createElement("div");
          el.className = "cursor";
          el.style.background = data[id].color;
          document.body.appendChild(el);
          cursors[id] = el;
        }
        cursors[id].style.left = data[id].x + "px";
        cursors[id].style.top = data[id].y + "px";
      }

      // Remove old cursors
      for (let id in cursors) {
        if (!data[id]) {
          cursors[id].remove();
          delete cursors[id];
        }
      }
    });
  </script>
</body>
</html>
